{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Varshil/Google%20Drive/It-Vedant/ComunityHere/Community/lib/mongodb.ts"],"sourcesContent":["import { MongoClient } from \"mongodb\"\r\n\r\nif (!process.env.MONGODB_URI) {\r\n  throw new Error('Invalid/Missing environment variable: \"MONGODB_URI\"')\r\n}\r\n\r\nconst uri = process.env.MONGODB_URI\r\nconst options = {\r\n  serverSelectionTimeoutMS: 5000, // Timeout after 5s instead of 30s\r\n  socketTimeoutMS: 45000, // Close sockets after 45s of inactivity\r\n}\r\n\r\nlet client: MongoClient\r\nlet clientPromise: Promise<MongoClient>\r\n\r\nif (process.env.NODE_ENV === \"development\") {\r\n  let globalWithMongo = global as typeof globalThis & {\r\n    _mongoClientPromise?: Promise<MongoClient>\r\n  }\r\n\r\n  if (!globalWithMongo._mongoClientPromise) {\r\n    client = new MongoClient(uri, options)\r\n    globalWithMongo._mongoClientPromise = client.connect().catch((error) => {\r\n      console.error(\"MongoDB connection error:\", error)\r\n      throw error\r\n    })\r\n  }\r\n  clientPromise = globalWithMongo._mongoClientPromise!\r\n} else {\r\n  client = new MongoClient(uri, options)\r\n  clientPromise = client.connect()\r\n}\r\n\r\nexport default clientPromise\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,UAAU;IACd,0BAA0B;IAC1B,iBAAiB;AACnB;AAEA,IAAI;AACJ,IAAI;AAEJ,wCAA4C;IAC1C,IAAI;IAIJ,IAAI,CAAC,gBAAgB,mBAAmB,EAAE;QACxC,SAAS,IAAI,sHAAW,CAAC,KAAK;QAC9B,gBAAgB,mBAAmB,GAAG,OAAO,OAAO,GAAG,KAAK,CAAC,CAAC;YAC5D,QAAQ,KAAK,CAAC,6BAA6B;YAC3C,MAAM;QACR;IACF;IACA,gBAAgB,gBAAgB,mBAAmB;AACrD;;uCAKe","debugId":null}},
    {"offset": {"line": 145, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Varshil/Google%20Drive/It-Vedant/ComunityHere/Community/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth from \"next-auth\"\r\nimport GoogleProvider from \"next-auth/providers/google\"\r\nimport CredentialsProvider from \"next-auth/providers/credentials\"\r\nimport clientPromise from \"@/lib/mongodb\"\r\nimport bcrypt from \"bcryptjs\"\r\nimport { Db } from \"mongodb\"\r\n\r\nconst handler = NextAuth({\r\n  providers: [\r\n    GoogleProvider({\r\n      clientId: process.env.GOOGLE_CLIENT_ID!,\r\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\r\n    }),\r\n    CredentialsProvider({\r\n      name: \"Credentials\",\r\n      credentials: {\r\n        email: { label: \"Email\", type: \"email\", placeholder: \"jsmith@example.com\" },\r\n        password: { label: \"Password\", type: \"password\" },\r\n      },\r\n      async authorize(credentials) {\r\n        if (!credentials?.email || !credentials?.password) {\r\n          throw new Error(\"Invalid credentials\")\r\n        }\r\n\r\n        const client = await clientPromise\r\n        const db = client.db(\"CommunityHere\")\r\n        const usersCollection = db.collection(\"users\")\r\n\r\n        const user = await usersCollection.findOne({ email: credentials.email })\r\n\r\n        if (!user) {\r\n          throw new Error(\"No user found with this email\")\r\n        }\r\n\r\n        const isPasswordValid = await bcrypt.compare(credentials.password, user.password)\r\n\r\n        if (!isPasswordValid) {\r\n          throw new Error(\"Invalid password\")\r\n        }\r\n\r\n        return {\r\n          id: user._id.toString(),\r\n          email: user.email,\r\n          name: user.name,\r\n          college: user.college,\r\n          department: user.department,\r\n          role: user.role,\r\n        }\r\n      },\r\n    }),\r\n  ],\r\n  callbacks: {\r\n    async signIn({ user, account }) {\r\n      if (account?.provider === \"google\") {\r\n        const client = await clientPromise\r\n        const db = client.db(\"CommunityHere\")\r\n        const usersCollection = db.collection(\"users\")\r\n\r\n        const existingUser = await usersCollection.findOne({ email: user.email })\r\n\r\n        if (!existingUser) {\r\n          // Create new user on first Google sign-in\r\n          await usersCollection.insertOne({\r\n            email: user.email,\r\n            name: user.name,\r\n            college: \"Not Set\",\r\n            department: \"Not Set\",\r\n            role: \"student\",\r\n            password: \"\",\r\n            createdAt: new Date(),\r\n            updatedAt: new Date(),\r\n          })\r\n        }\r\n      }\r\n      return true\r\n    },\r\n    async redirect({ url, baseUrl }) {\r\n      // After Google OAuth, redirect to discussions page\r\n      if (url.startsWith(baseUrl)) {\r\n        return url\r\n      }\r\n      // Default redirect to discussions after login\r\n      return `${baseUrl}/discussions`\r\n    },\r\n    async jwt({ token, user, account }) {\r\n      // Initial sign in - fetch full user data from MongoDB\r\n      if (user) {\r\n        const client = await clientPromise\r\n        const db = client.db(\"CommunityHere\")\r\n        const usersCollection = db.collection(\"users\")\r\n        \r\n        // Fetch full user data from MongoDB\r\n        const dbUser = await usersCollection.findOne({ email: user.email })\r\n        \r\n        if (dbUser) {\r\n          token.id = dbUser._id.toString()\r\n          token.name = dbUser.name || user.name\r\n          token.email = dbUser.email || user.email\r\n          token.role = dbUser.role || \"student\"\r\n          token.college = dbUser.college\r\n          token.department = dbUser.department\r\n          token.committee = dbUser.committee\r\n        } else {\r\n          // Fallback to user data from provider\r\n          token.id = user.id || user.email || \"\"\r\n          token.name = user.name || \"\"\r\n          token.email = user.email || \"\"\r\n          token.role = (user as any).role || \"student\"\r\n          token.college = (user as any).college\r\n          token.department = (user as any).department\r\n        }\r\n        \r\n        // Generate session ID for student login\r\n        if (!token.sessionId) {\r\n          token.sessionId = `SESS-${Date.now()}-${Math.random().toString(36).substring(2, 9).toUpperCase()}`\r\n        }\r\n      }\r\n      \r\n      return token\r\n    },\r\n    async session({ session, token }) {\r\n      if (session.user) {\r\n        const user = session.user as any\r\n        const tokenData = token as any\r\n        user.id = tokenData.id\r\n        user.role = tokenData.role || \"student\"\r\n        user.college = tokenData.college\r\n        user.department = tokenData.department\r\n        user.committee = tokenData.committee\r\n        user.sessionId = tokenData.sessionId\r\n        // Ensure name and email are set\r\n        if (!user.name && tokenData.name) {\r\n          user.name = tokenData.name as string\r\n        }\r\n        if (!user.email && tokenData.email) {\r\n          user.email = tokenData.email as string\r\n        }\r\n      }\r\n      return session\r\n    },\r\n  },\r\n  pages: {\r\n    signIn: \"/login\",\r\n    error: \"/login\",\r\n  },\r\n  session: {\r\n    strategy: \"jwt\",\r\n  },\r\n  secret: process.env.NEXTAUTH_SECRET,\r\n})\r\n\r\nexport { handler as GET, handler as POST }\r\n"],"names":[],"mappings":"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","debugId":null}}]
}